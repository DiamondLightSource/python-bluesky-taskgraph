<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>How to construct a TaskGraph &mdash; bluesky_taskgraph_runner 0.0.1.pre+25.gf0ac3d3 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/dls-favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Why are Task in/out names defined by the TaskGraph?" href="../explanations/task-in-out.html" />
    <link rel="prev" title="How to construct a Task" href="construct-a-task.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: rgb(7, 43, 93)" >
            <a href="../index.html" class="icon icon-home"> bluesky_taskgraph_runner
            <img src="../_static/dls-logo.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                master
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/installation.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How-to Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="construct-a-control-object.html">Constructing a ControlObject</a></li>
<li class="toctree-l1"><a class="reference internal" href="construct-a-task.html">How to construct a Task</a></li>
<li class="toctree-l1"><a class="reference internal" href="construct-a-task.html#how-big-should-a-task-be">How big should a task be?</a></li>
<li class="toctree-l1"><a class="reference internal" href="construct-a-task.html#optional-and-conditional-tasks">Optional and Conditional Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="construct-a-task.html#task-argument-ordering">Task argument ordering</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">How to construct a TaskGraph</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Explanations</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../explanations/task-in-out.html">Why are Task in/out names defined by the TaskGraph?</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/DiamondLightSource/python-bluesky-taskgraph/releases">Releases</a></li>
<li class="toctree-l1"><a class="reference external" href="genindex.html#http://">Index</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: rgb(7, 43, 93)" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">bluesky_taskgraph_runner</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>How to construct a TaskGraph</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/how-to/construct-a-taskgraph.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="how-to-construct-a-taskgraph">
<h1>How to construct a TaskGraph<a class="headerlink" href="#how-to-construct-a-taskgraph" title="Permalink to this headline">ÔÉÅ</a></h1>
<p>A TaskGraph contains a trio of mappings: from each task to every task it directly depends upon, or cannot be run
concurrently with, from each task to the names of all the inputs it requires for execution and from each task to the
names of all of the outputs it will provide.
This allows for the output of a task to override initial values, or the output values of previous tasks: devices, seek
values, read back values should therefore either be named sensibly to prevent, or the TaskGraph should be constructed
with this behaviour in mind.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># A task graph with one task that must be run before another</span>
<span class="k">def</span> <span class="nf">simple_task_graph</span><span class="p">():</span>
    <span class="n">first_task</span> <span class="o">=</span> <span class="n">BlueskyTask</span><span class="p">(</span><span class="s2">&quot;Task must run first&quot;</span><span class="p">)</span>
    <span class="n">second_task</span> <span class="o">=</span> <span class="n">BlueskyTask</span><span class="p">(</span><span class="s2">&quot;Task runs second&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">TaskGraph</span><span class="p">({</span><span class="n">first_task</span><span class="p">:</span> <span class="p">[],</span> <span class="n">second_task</span><span class="p">:</span> <span class="p">[</span><span class="n">first_task</span><span class="p">]},</span> <span class="p">{},</span> <span class="p">{})</span>

<span class="c1"># A task graph where the input of the second task is the output of the first</span>
<span class="k">def</span> <span class="nf">task_graph_with_outputs</span><span class="p">():</span>
    <span class="n">first_task</span> <span class="o">=</span> <span class="n">BlueskyTask</span><span class="p">(</span><span class="s2">&quot;Outputs necessary future input&quot;</span><span class="p">)</span>
    <span class="n">second_task</span> <span class="o">=</span> <span class="n">BlueskyTask</span><span class="p">(</span><span class="s2">&quot;Input from previous&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">TaskGraph</span><span class="p">({</span><span class="n">first_task</span><span class="p">:</span> <span class="p">[],</span> <span class="n">second_task</span><span class="p">:</span> <span class="p">[</span><span class="n">first_task</span><span class="p">]},</span>
        <span class="p">{</span><span class="n">second_task</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;information&quot;</span><span class="p">]},</span> <span class="p">{</span><span class="n">first_task</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;information&quot;</span><span class="p">]})</span>

<span class="c1"># Task graphs may be constructed by addition of task graphs, which creates a graph with all tasks from both with</span>
<span class="c1">#  no interdependencies.</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">simple_task_graph</span><span class="p">()</span> <span class="o">+</span> <span class="n">task_graph_with_outputs</span><span class="p">()</span>


<span class="c1"># A task graph can be dependent on a previously constructed task graph, or can be depended on by a previously</span>
<span class="c1">#  constructed task graph.</span>
<span class="c1">#  A task graph that is dependent on another places all tasks in the other as a dependency for every task in it.</span>

<span class="c1"># All tasks in task_graph_with_outputs would run first, then all in simple_task_graph</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">simple_task_graph</span><span class="p">()</span><span class="o">.</span><span class="n">depends_on</span><span class="p">(</span><span class="n">task_graph_with_outputs</span><span class="p">())</span>
<span class="c1"># All tasks in simple_task_graph would run first, then all in task_graph_with_outputs</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">simple_task_graph</span><span class="p">()</span><span class="o">.</span><span class="n">is_depended_on_by</span><span class="p">(</span><span class="n">task_graph_with_outputs</span><span class="p">())</span>

<span class="c1"># These operations can be chained</span>
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="construct-a-task.html" class="btn btn-neutral float-left" title="How to construct a Task" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../explanations/task-in-out.html" class="btn btn-neutral float-right" title="Why are Task in/out names defined by the TaskGraph?" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
   
  <div id="other-versions-div" class="rst-versions" data-toggle="rst-versions" role="note" aria-label="Versions" style="visibility: hidden">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Other Versions</span>
      master
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl id="other-versions-dl"/>
    </div>
  </div>
  <script>
    function addVersion(name) {
      var dd = document.createElement("dd");
      var a = document.createElement("a");
      a.href = "../../" + name;
      a.innerText = name;
      dd.appendChild(a);
      document.getElementById('other-versions-dl').appendChild(dd);
    }
    // Get versions.txt and add a version for each line
    fetch("../../versions.txt").then(response => {
      if (response.ok) {
        document.getElementById('other-versions-div').style.visibility = "visible";
        return response.text().then(text => text.split(/\r?\n/).forEach(addVersion))
      }
    });
  </script>


</body>
</html>